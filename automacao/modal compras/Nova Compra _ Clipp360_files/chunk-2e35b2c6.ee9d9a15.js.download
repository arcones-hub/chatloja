(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-2e35b2c6"],{"273e":function(t,e,r){"use strict";r("629a")},"29df":function(t,e,r){"use strict";r("6e6d")},"334f":function(t,e,r){},"45f4":function(t,e,r){},"629a":function(t,e,r){},"6e6d":function(t,e,r){},9983:function(t,e,r){"use strict";r.r(e);var a=function(){var t=this,e=t.$createElement,r=t._self._c||e;return r("Layout",[r("b-row",{staticClass:"pb-4 pt-2"},[r("b-col",{staticClass:"d-flex justify-content-between"},[r("Button",{attrs:{location:"title",type:"white"},on:{click:function(e){return t.handleCancelPurchase()}}},[t._v("Voltar")]),r("h1",{staticClass:"title"},[t._v("Nova Compra")]),r("ImportXmlFile",{attrs:{disabled:null!==t.importedInvoiceFormData},on:{file:t.handleXmlFile,manifest:t.handleManifestedXmlModal}})],1)],1),r("TaxInformation",{ref:"taxInformation"}),t.showLinkedDocuments?r("LinkedDocuments",{ref:"linkedDocuments"}):t._e(),r("Supplier",{ref:"supplier"}),r("Products",{ref:"products"}),r("TaxCalc",{ref:"taxCalc"}),r("Transport",{ref:"transport"}),r("Payment",{ref:"payments"}),r("ModalFiscalProduct"),t.modalPriceUpdateIsOpen?r("ModalPriceUpdate",{attrs:{confirm:t.onConfirmPriceUpdateModal}}):t._e(),t.modalImportXmlIsOpen?r("ModalImportXml",{attrs:{confirm:t.confirm}}):t._e(),t.modalManifestedXmlsIsOpen?r("ModalManifestedXmls",{attrs:{confirm:t.importManifestToPurchase}}):t._e(),r("b-row",{staticClass:"margin-button-save text-center"},[r("b-col",[r("Button",{attrs:{type:"cancel"},on:{click:function(e){return t.handleCancelPurchase()}}},[r("Close",{staticClass:"mb-1",attrs:{title:"Cancelar"}}),t._v(" Cancelar ")],1),r("Button",{attrs:{type:"success"},on:{click:function(e){return t.handleSavePurchase()}}},[t._v("Salvar")])],1)],1)],1)},o=[],n=(r("7db0"),r("4160"),r("caad"),r("d81d"),r("13d5"),r("b0c0"),r("a9e3"),r("d3b7"),r("3ca3"),r("159b"),r("ddb0"),r("96cf"),r("1da1")),i=r("5530"),c=r("2f62"),s=r("7eb5"),u=r("2af9"),l=r("2127"),d=r("8fc5"),p=r("f8b2"),m=r("88da"),f=r("6d1b"),v=r("ae7f"),h=r("371b"),b=r("3c47"),C=r("9835"),g=r("e256"),I=function(){var t=this,e=t.$createElement,r=t._self._c||e;return r("Modal",{staticClass:"importationModal",attrs:{value:t.modalImportXmlIsOpen,onClose:t.cancelImportXml,size:"large"}},[r("Accordion",{attrs:{id:"importationTopCollapse",title:"INFORMAÇÕES GERAIS"}},[r("b-row",{attrs:{"align-v":"end"}},[r("b-col",{attrs:{md:"3",lg:"4"}},[r("label",{attrs:{for:"input-live"}},[t._v("Natureza de Operação")]),r("b-form-input",{attrs:{value:t.importedInvoice.taxInformation.natOp,disabled:""}})],1),r("b-col",{attrs:{md:"4",lg:"5"}},[r("label",{attrs:{for:"input-live"}},[t._v("Chave de Acesso NFe:")]),r("b-form-input",{attrs:{id:"nfeKey",value:t.importedInvoice.taxInformation.nfe.nfeKey,disabled:""}})],1),r("b-col",{attrs:{md:"3",lg:"2"}},[r("label",{attrs:{for:"input-live"}},[t._v("NF. Número:")]),r("b-form-input",{attrs:{id:"nfeNumber",value:t.importedInvoice.taxInformation.nfe.nfeNumber,disabled:""}})],1),r("b-col",{attrs:{md:"2",lg:"1"}},[r("label",{attrs:{for:"input-live"}},[t._v("Série:")]),r("b-form-input",{attrs:{id:"nfeSerie",value:t.importedInvoice.taxInformation.nfe.nfeSerie,disabled:""}})],1)],1),r("b-row",{staticClass:"mt-2",attrs:{"align-v":"end"}},[r("b-col",{attrs:{md:"3",lg:"4"}},[r("label",{attrs:{for:"input-live"}},[t._v("Fornecedor:")]),r("b-form-input",{attrs:{id:"supplierName",value:t.importedInvoice.supplier.name,disabled:""}})],1),r("b-col",{attrs:{md:"4"}},[r("label",{attrs:{for:"input-live"}},[t._v("CPF/CNPJ:")]),r("b-form-input",{directives:[{name:"mask",rawName:"v-mask",value:[t.cpfMask,t.cnpjMask],expression:"[cpfMask, cnpjMask]"}],attrs:{id:"supplierIdentification",value:t.importedInvoice.supplier.identification,disabled:""}})],1),r("b-col",{attrs:{md:"3",lg:"3"}},[r("label",{attrs:{for:"input-live"}},[t._v("Endereço:")]),r("b-form-input",{attrs:{id:"supplierAddressStreet",value:t.importedInvoice.supplier.address.street,disabled:""}})],1),r("b-col",{attrs:{md:"2",lg:"1"}},[r("label",{attrs:{for:"input-live"}},[t._v("Número:")]),r("b-form-input",{attrs:{id:"supllierAddressNumber",value:t.importedInvoice.supplier.address.number,disabled:""}})],1)],1),r("b-row",{staticClass:"mt-2",attrs:{"align-v":"end"}},[r("b-col",{attrs:{md:"6",lg:"4"}},[r("label",{attrs:{for:"input-live"}},[t._v("Bairro:")]),r("b-form-input",{attrs:{id:"addressNeighbourhood",value:t.importedInvoice.supplier.address.neighbourhood,disabled:""}})],1),r("b-col",{attrs:{md:"3",lg:"2"}},[r("label",{attrs:{for:"input-live"}},[t._v("CEP:")]),r("b-form-input",{directives:[{name:"mask",rawName:"v-mask",value:t.cepMask,expression:"cepMask"}],attrs:{id:"addressZipCodeCep",value:t.importedInvoice.supplier.address.zipCode.zipCode,disabled:""}})],1),r("b-col",[r("label",{attrs:{for:"input-live"}},[t._v("Cidade:")]),r("b-form-input",{attrs:{id:"addressZipCodeCityName",value:t.importedInvoice.supplier.address.zipCode.city.name,disabled:""}})],1),r("b-col",{attrs:{md:"2",lg:"1"}},[r("label",{attrs:{for:"input-live"}},[t._v("UF:")]),r("b-form-input",{attrs:{id:"addressZipCodeUf",value:t.importedInvoice.supplier.address.zipCode.city.state.acronym,disabled:""}})],1),r("b-col",{attrs:{md:"3",lg:"2"}},[r("label",{attrs:{for:"input-live"}},[t._v("Data Emissão:")]),r("b-form-input",{attrs:{id:"issueDate",value:t.formatDate(t.importedInvoice.taxInformation.issueDate),disabled:""}})],1)],1)],1),t.showLinkedDocuments?r("Accordion",{attrs:{id:"importationLinkedDocuments",title:"DOCUMENTOS VINCULADOS"}},[r("b-row",t._l(t.importedInvoice.linkedDocuments.linkedDocumentCollection,(function(t,e){return r("b-col",{key:e,staticClass:"mt-2",attrs:{md:"6"}},[r("b-form-input",{attrs:{value:t.docKey,disabled:""}})],1)})),1)],1):t._e(),r("Accordion",{attrs:{id:"importationProducts",title:"PRODUTOS"}},[r("b-row",{staticClass:"margin-product-title"},[r("b-col",{attrs:{sm:"4"}},[r("h4",[t._v("Produtos")])])],1),t.importedInvoice.products.productOfPurchaseCollection.length?r("b-row",{staticClass:"table-import-products"},[r("b-col",[r("table",{staticClass:"table tableFixHead"},[r("thead",[r("tr",[r("th",{staticClass:"col-4"},[t._v("Desc.")]),r("th",[t._v("Cadastro Estoque")]),r("th",{staticClass:"col-1"},[t._v("CFOP")]),r("th",{staticClass:"col-1"},[t._v("Qtd")]),r("th",{staticClass:"col-1"},[t._v("Unitário")]),r("th",[t._v("Uni. Conversão")]),r("th",{staticClass:"col-1"},[t._v("Total")]),r("th",[r("a",{attrs:{href:"javascript:"},on:{click:t.parametrizeAll}},[r("ArrangeBringToFront",{attrs:{title:"Parametrizar Todos"}})],1)]),r("th",[r("a",{attrs:{href:"javascript:"},on:{click:t.unparametrizeAll}},[r("ArrangeSendToBack",{attrs:{title:"Desparametrizar Todos"}})],1)])])]),r("tbody",t._l(t.importedInvoice.products.productOfPurchaseCollection,(function(e,a){return r("tr",{key:a},[r("td",[r("b-form-input",{staticStyle:{"min-width":"150px"},attrs:{id:"productDescription",value:e.description,disabled:null!==t.productsInStock[a]},model:{value:t.importedInvoice.products.productOfPurchaseCollection[a].description,callback:function(e){t.$set(t.importedInvoice.products.productOfPurchaseCollection[a],"description",e)},expression:"\n                    importedInvoice.products.productOfPurchaseCollection[index].description\n                  "}})],1),r("td",{staticClass:"cadastro-estoque"},[r("SelectWithSearch",{ref:"searchProduct",refInFor:!0,attrs:{filterBy:t.productFilter,placeholder:"Selecione",id:a,options:t.productCollectionSelect,change:t.linkProduct,search:t.searchProduct},scopedSlots:t._u([{key:"options",fn:function(e){return[r("div",{staticClass:"selected"},[t._v(" "+t._s(e.data.description)+" ")])]}},{key:"selected",fn:function(e){return[r("div",{directives:[{name:"b-tooltip",rawName:"v-b-tooltip.hover.top",modifiers:{hover:!0,top:!0}}],staticClass:"selected",staticStyle:{"text-transform":"uppercase"},attrs:{title:e.data.description}},[t._v(" "+t._s(e.data.description)+" ")])]}}],null,!0),model:{value:t.productsInStock[a],callback:function(e){t.$set(t.productsInStock,a,e)},expression:"productsInStock[index]"}},[r("template",{slot:"no-options"},[t._v("Nenhum produto encontrado")])],2)],1),r("td",[r("SelectWithSearch",{staticClass:"cfop",attrs:{id:a,change:t.changeCfop,options:t.adaptedCfopCollection,filterBy:t.descriptionFilter,clearable:!1},scopedSlots:t._u([{key:"options",fn:function(e){return[r("div",{staticClass:"selected"},[t._v(" "+t._s(e.data.codigo)+" - "+t._s(e.data.descricao)+" ")])]}},{key:"selected",fn:function(e){return[r("div",{staticClass:"selected"},[t._v(" "+t._s(e.data.codigo)+" - "+t._s(e.data.descricao)+" ")])]}}],null,!0),model:{value:t.importedInvoice.products.productOfPurchaseCollection[a].fiscal.values.cfop,callback:function(e){t.$set(t.importedInvoice.products.productOfPurchaseCollection[a].fiscal.values,"cfop",e)},expression:"\n                    importedInvoice.products.productOfPurchaseCollection[index].fiscal.values.cfop\n                  "}},[r("template",{slot:"no-options"},[t._v(" Selecione um código ")])],2)],1),r("td",{attrs:{id:"quantityPurchased"}},[t._v(" "+t._s(t.roundAndFormat(e.quantityPurchased,t.decimalConfiguration.quantity))+" ")]),r("td",{staticClass:"table_ellipsis",attrs:{id:"productPrice"}},[t._v(" "+t._s("R$ "+t.roundAndFormat(e.price,t.decimalConfiguration.price))+" ")]),r("td",[r("SelectWithSearch",{ref:"searchCfop",refInFor:!0,attrs:{labelBusca:"name",placeholder:"Selecione",id:a,clearable:!1,options:t.unitOfMeasureSelect,change:t.changeUnitOfMeasure,search:t.searchUnitOfMeasure},scopedSlots:t._u([{key:"options",fn:function(e){return[r("div",{staticClass:"selected",staticStyle:{"text-transform":"uppercase"}},[t._v(" "+t._s(e.data.name)+" - ("+t._s(t.returnsCharacterOperator(e.data.converterOperator))+" "+t._s(t.valorReal(e.data.converter))+") ")])]}},{key:"selected",fn:function(e){return[r("div",{staticClass:"selected",staticStyle:{"text-transform":"uppercase"}},[t._v(" "+t._s(e.data.acronym)+" ")])]}}],null,!0),model:{value:t.importedInvoice.products.productOfPurchaseCollection[a].unitOfMeasure,callback:function(e){t.$set(t.importedInvoice.products.productOfPurchaseCollection[a],"unitOfMeasure",e)},expression:"\n                    importedInvoice.products.productOfPurchaseCollection[index].unitOfMeasure\n                  "}},[r("template",{slot:"no-options"},[t._v("Nenhuma unidade encontrada")])],2)],1),r("td",{staticClass:"table_ellipsis",attrs:{id:"productTotalPrice"}},[t._v(" "+t._s("R$ "+t.roundAndFormat(e.price*e.quantityPurchased,t.decimalConfiguration.price))+" ")]),r("td",{attrs:{align:"right"}},[r("a",{attrs:{href:"javascript:"},on:{click:function(e){return t.checkForChangeParametrization(a)}}},[t.productsInStock[a]&&t.productsInStock[a].productIsParametrized?r("div",[r("ArrangeBringToFront",{attrs:{title:"Desparametrizar produto"}})],1):r("div",[r("ArrangeSendToBack",{attrs:{title:"Parametrizar produto"}})],1)])]),r("td",{attrs:{align:"right"}},[r("a",{staticClass:"remove-product text-muted",attrs:{href:"javascript:"},on:{click:function(e){return t.removeProduct(a)}}},[r("Close")],1)])])})),0)])])],1):t._e()],1),r("Accordion",{attrs:{id:"importationBottomCollapse",title:"TRANSPORTADORA/IMPOSTOS"}},[r("b-row",[r("b-col",{attrs:{sm:"5"}},[r("label",{attrs:{for:"input-live"}},[t._v("Transportadora:")]),r("b-form-input",{attrs:{value:t.importedInvoice.transport.shippingCompany?t.importedInvoice.transport.shippingCompany.name:"",disabled:""}})],1),r("b-col",{attrs:{sm:"3"}},[r("label",{attrs:{for:"input-live"}},[t._v("CPF/CNPJ:")]),r("b-form-input",{directives:[{name:"mask",rawName:"v-mask",value:[t.cpfMask,t.cnpjMask],expression:"[cpfMask, cnpjMask]"}],attrs:{value:t.importedInvoice.transport.shippingCompany?t.importedInvoice.transport.shippingCompany.identification:"",disabled:""}})],1),r("b-col",{attrs:{sm:"2"}},[r("label",{attrs:{for:"input-live"}},[t._v("Desconto:")]),r("b-form-input",{attrs:{value:t.valorReal(t.importedInvoice.taxCalc.vDesc),disabled:""}})],1),r("b-col",{attrs:{sm:"2"}},[r("label",{attrs:{for:"input-live"}},[t._v("Valor Frete:")]),r("b-form-input",{attrs:{value:t.valorReal(t.importedInvoice.taxCalc.vFrete),disabled:""}})],1)],1),r("b-row",{staticClass:"mt-2"},[r("b-col",{attrs:{sm:"2"}},[r("label",{attrs:{for:"input-live"}},[t._v("Base ICMS:")]),r("b-form-input",{attrs:{value:t.valorReal(t.importedInvoice.taxCalc.vBC),disabled:""}})],1),r("b-col",{attrs:{sm:"2"}},[r("label",{attrs:{for:"input-live"}},[t._v("Valor ICMS:")]),r("b-form-input",{attrs:{value:t.valorReal(t.importedInvoice.taxCalc.vICMS),disabled:""}})],1),r("b-col",{attrs:{sm:"2"}},[r("label",{attrs:{for:"input-live"}},[t._v("Valor IPI:")]),r("b-form-input",{attrs:{value:t.valorReal(t.importedInvoice.taxCalc.vIPI),disabled:""}})],1),r("b-col",{attrs:{sm:"2"}},[r("label",{attrs:{for:"input-live"}},[t._v("Valor ST:")]),r("b-form-input",{attrs:{value:t.valorReal(t.importedInvoice.taxCalc.vICMSST),disabled:""}})],1),r("b-col",{attrs:{sm:"2"}},[r("label",{attrs:{for:"input-live"}},[t._v("Valor FCP ST:")]),r("b-form-input",{attrs:{value:t.valorReal(t.importedInvoice.taxCalc.vFCPST),disabled:""}})],1),r("b-col",{attrs:{sm:"2"}},[r("label",{attrs:{for:"input-live"}},[t._v("Seguro:")]),r("b-form-input",{attrs:{value:t.valorReal(t.importedInvoice.taxCalc.vSeg),disabled:""}})],1)],1),r("b-row",{staticClass:"mt-2"},[r("b-col",{attrs:{sm:"2"}},[r("label",{attrs:{for:"input-live"}},[t._v("Outras Despesas:")]),r("b-form-input",{attrs:{value:t.valorReal(t.importedInvoice.taxCalc.vOutro),disabled:""}})],1),r("b-col",{attrs:{sm:"2"}},[r("label",{attrs:{for:"input-live"}},[t._v("Total Produtos:")]),r("b-form-input",{attrs:{value:t.valorReal(t.importedInvoice.taxCalc.vProd),disabled:""}})],1),r("b-col",{attrs:{sm:"2"}},[r("label",{staticClass:"align-self-end",attrs:{for:"input-live"}},[t._v("Total nota:")]),r("b-form-input",{attrs:{value:t.valorReal(t.importedInvoice.taxCalc.vNF),disabled:""}})],1)],1),r("IBSRegimeTaxesData",{staticClass:"mt-2",attrs:{IbsTaxRegimeTotals:t.importedInvoice.taxCalc.IBSTaxRegime}})],1),r("b-row",{staticClass:"margin-button-save",attrs:{align:"center"}},[r("b-col",[r("Button",{attrs:{type:"cancel"},on:{click:function(e){return t.cancelImportXml()}}},[r("Close",{staticClass:"mb-1",attrs:{title:"Cancelar"}}),t._v(" Cancelar ")],1),r("Button",{attrs:{type:"success"},on:{click:function(e){return t.importXmlToPurchase()}}},[t._v("Importar")])],1)],1)],1)},O=[],P=(r("a4d3"),r("e01a"),r("99af"),r("4de4"),r("a15b"),r("fb6a"),r("a434"),r("2532"),r("3835")),k=r("2ef0"),x=r.n(k),j=function(t,e){var r=e._c;return r("span",e._g(e._b({staticClass:"material-design-icon arrange-send-to-back-icon",class:[e.data.class,e.data.staticClass],attrs:{"aria-hidden":e.props.decorative,"aria-label":e.props.title,role:"img"}},"span",e.data.attrs,!1),e.listeners),[r("svg",{staticClass:"material-design-icon__svg",attrs:{fill:e.props.fillColor,width:e.props.size,height:e.props.size,viewBox:"0 0 24 24"}},[r("path",{attrs:{d:"M2,2H11V11H2V2M9,4H4V9H9V4M22,13V22H13V13H22M15,20H20V15H15V20M16,8V11H13V8H16M11,16H8V13H11V16Z"}},[r("title",[e._v(e._s(e.props.title))])])])])},_=[],w={name:"ArrangeSendToBackIcon",props:{title:{type:String,default:"Arrange Send To Back icon"},decorative:{type:Boolean,default:!1},fillColor:{type:String,default:"currentColor"},size:{type:Number,default:24}}},M=w,S=r("2877"),y=Object(S["a"])(M,j,_,!0,null,null,null),R=y.exports,D=function(t,e){var r=e._c;return r("span",e._g(e._b({staticClass:"material-design-icon arrange-bring-to-front-icon",class:[e.data.class,e.data.staticClass],attrs:{"aria-hidden":e.props.decorative,"aria-label":e.props.title,role:"img"}},"span",e.data.attrs,!1),e.listeners),[r("svg",{staticClass:"material-design-icon__svg",attrs:{fill:e.props.fillColor,width:e.props.size,height:e.props.size,viewBox:"0 0 24 24"}},[r("path",{attrs:{d:"M2,2H11V6H9V4H4V9H6V11H2V2M22,13V22H13V18H15V20H20V15H18V13H22M8,8H16V16H8V8Z"}},[r("title",[e._v(e._s(e.props.title))])])])])},T=[],z={name:"ArrangeBringToFrontIcon",props:{title:{type:String,default:"Arrange Bring To Front icon"},decorative:{type:Boolean,default:!1},fillColor:{type:String,default:"currentColor"},size:{type:Number,default:24}}},F=z,A=Object(S["a"])(F,D,T,!0,null,null,null),N=A.exports,B=r("a29d"),X=r("b018"),$=r("bc24"),V=r("50f7"),L=r("6148"),U={name:"modalImportXml",mixins:[d["a"],B["a"]],components:{Modal:u["u"],Close:s["a"],Button:u["c"],Accordion:u["a"],SelectWithSearch:u["N"],ArrangeSendToBack:R,ArrangeBringToFront:N,IBSRegimeTaxesData:$["a"]},props:{confirm:{type:Function}},data:function(){return{adaptedCfopCollection:[],productsInStock:[],cepMask:"#####-###",cpfMask:"###.###.###.##",cnpjMask:"##.###.###/####-##",money:{decimal:",",thousands:".",prefix:"",suffix:"",precision:2,masked:!1},productFilter:x.a.debounce(function(){var t=Object(n["a"])(regeneratorRuntime.mark((function t(e,r){var a,o;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return a=r.toLocaleLowerCase(),o=e.description.toLocaleLowerCase(),t.abrupt("return",o.includes(a));case 3:case"end":return t.stop()}}),t)})));return function(e,r){return t.apply(this,arguments)}}(),350)}},mounted:function(){var t=this;return Object(n["a"])(regeneratorRuntime.mark((function e(){var r;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,t.setCfopCollection();case 2:return e.next=4,t.setUnitOfMeasureCollection();case 4:return t.adaptCfopCollection(),r=t.importedInvoice.products.productOfPurchaseCollection,e.next=8,r.map((function(t){if(null===t||void 0===t||!t.productId)return null;var e=Object(i["a"])({},t);return e.description=t.stockDescription,e}));case 8:t.productsInStock=e.sent,t.setProductsInStock(),t.adjustCfop();case 11:case"end":return e.stop()}}),e)})))()},computed:Object(i["a"])(Object(i["a"])(Object(i["a"])(Object(i["a"])(Object(i["a"])(Object(i["a"])(Object(i["a"])(Object(i["a"])({},Object(c["d"])("purchase",["importedInvoice","transport","purchaseParams","taxInformation"])),Object(c["d"])("product",["productCollection","productInventory"])),Object(c["d"])("unitOfMeasure",["unitOfMeasureCollection"])),Object(c["d"])("fiscalComponents",["cfopCollection"])),Object(c["d"])("componentsPurchase",["modalImportXmlIsOpen"])),Object(c["c"])("purchase",["decimalConfiguration","productOfPurchaseCollectionXmlImportation"])),Object(c["d"])("purchase",["purchase","transport","purchaseParams","taxInformation","importedInvoice"])),{},{unitOfMeasureSelect:function(){return this.unitOfMeasureCollection.slice(0,5)},productCollectionSelect:function(){return this.productCollection},showLinkedDocuments:function(){var t,e,r;return null===(t=this.importedInvoice)||void 0===t||null===(e=t.linkedDocuments)||void 0===e||null===(r=e.linkedDocumentCollection)||void 0===r?void 0:r.length}}),methods:Object(i["a"])(Object(i["a"])(Object(i["a"])(Object(i["a"])(Object(i["a"])(Object(i["a"])(Object(i["a"])(Object(i["a"])({},Object(c["b"])("purchase",["setPurchase","updateImportedInvoiceData","setLinkedProducts","setLinkedTaxInformation","setPurchaseFromImport","setShippingCompanyById","setDecimalConfiguration","clearXmlFormData","setMatchedCfopForPurchaseTaxInformation"])),Object(c["b"])("fiscalComponents",["setCfopCollection"])),Object(c["b"])("unitOfMeasure",["setUnitOfMeasureCollection"])),Object(c["b"])("product",["setProductCollection","setProductInventory"])),Object(c["b"])("componentsPurchase",["toggleModalImportXml"])),Object(c["b"])("person",["setVehicleCollection","setAddressCollection","changeProductParametrization","checkIfProductIsParametrized","checkIfCodeHasParametrization","unparametrizeAllProducts","parametrizeAllProducts","registerProducts","parameterizeTaxes"])),Object(c["b"])("application",["setLoading"])),{},{adaptCfopCollection:function(){this.adaptedCfopCollection=this.cfopCollection.filter((function(t){return["1","2","3"].includes(t.codigo[0])}))},adjustCfop:function(){var t=this;this.importedInvoice.products.productOfPurchaseCollection.forEach((function(e,r){var a,o=e.fiscal.values.cfop,n=o.codigo[0];switch(n){case"5":a="1";break;case"6":a="2";break;case"7":a="3";break;default:a=n;break}var i=a+o.codigo.slice(1),c=t.cfopCollection.filter((function(t){return t.codigo===i}));t.importedInvoice.products.productOfPurchaseCollection[r].fiscal.values.cfop=c}))},handleRegisterProducts:function(){var t=this;return Object(n["a"])(regeneratorRuntime.mark((function e(){var r,a,o,n,i,c,s;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(a=t.productsInStock,o=t.importedInvoice.products.productOfPurchaseCollection.filter((function(t,e){return null==a[e]&&(null===t||void 0===t?void 0:t.description)})),o.length){e.next=6;break}return e.next=5,t.setLinkedProducts(t.productsInStock);case 5:return e.abrupt("return",!0);case 6:if(n=t.importedInvoice.products.productOfPurchaseCollection.filter((function(t){return null==t.productId&&t.barCode})),n.length){e.next=9;break}return e.abrupt("return",!0);case 9:return e.next=11,t.registerProductsInStock();case 11:if(i=e.sent,null!==(r=i.messages)&&void 0!==r&&r.length&&t.$alert.error("".concat(i.messages.map((function(t){return"<li>".concat(t,"</li>")})).join(""))),c=i.products.productOfPurchaseCollection.filter((function(t){var e;return t.productId&&(null===(e=i.registeredIds)||void 0===e?void 0:e.includes(t.productId))})),s=i.products.productOfPurchaseCollection.filter((function(t){return null==t.productId})),!c.length){e.next=22;break}return e.next=18,t.setLinkedProducts(i.products.productOfPurchaseCollection);case 18:return e.next=20,t.parameterizeTaxes({data:{productOfPurchaseCollection:i.products.productOfPurchaseCollection}});case 20:if(s.length){e.next=22;break}return e.abrupt("return",!0);case 22:return e.abrupt("return",!1);case 23:case"end":return e.stop()}}),e)})))()},importXmlToPurchase:function(){var t=this;return Object(n["a"])(regeneratorRuntime.mark((function e(){var r,a,o;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,t.handleRegisterProducts();case 2:if(a=e.sent,a){e.next=5;break}return e.abrupt("return");case 5:return e.next=7,t.setPurchaseFromImport(t.importedInvoice);case 7:if(null===(r=t.importedInvoice.transport.shippingCompany)||void 0===r||!r.id){e.next=15;break}return e.next=10,t.setShippingCompanyById(t.importedInvoice.transport);case 10:return o=t.transport.shippingCompany,e.next=13,t.setAddressCollection(o);case 13:return e.next=15,t.setVehicleCollection(o);case 15:t.toggleModalImportXml(),t.buildTaxInformationCfop();case 17:case"end":return e.stop()}}),e)})))()},setProductsInStock:function(){this.productsInStock=this.importedInvoice.products.productOfPurchaseCollection.map((function(t){if(null===t||void 0===t||!t.productId)return null;var e=Object(i["a"])({},t);return e.description=t.stockDescription||t.description,e}))},buildTaxInformationCfop:function(){this.taxInformation.natureza.cfop.id&&this.setMatchedCfopForPurchaseTaxInformation({supplierId:this.importedInvoice.supplier.id,cfopIdPurchaseHeader:this.taxInformation.natureza.cfop.id})},cancelImportXml:function(){var t=this;return Object(n["a"])(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,t.clearXmlFormData();case 2:return e.next=4,t.toggleModalImportXml();case 4:case"end":return e.stop()}}),e)})))()},returnsCharacterOperator:function(t){return t===V["b"]?"x":"/"},searchUnitOfMeasure:function(t){var e=this;return Object(n["a"])(regeneratorRuntime.mark((function r(){return regeneratorRuntime.wrap((function(r){while(1)switch(r.prev=r.next){case 0:if(!t){r.next=3;break}return r.next=3,e.setUnitOfMeasureCollection({search:t});case 3:case"end":return r.stop()}}),r)})))()},changeCfop:function(t,e){if(t){var r=this.importedInvoice.products.productOfPurchaseCollection[e].fiscal;r.values.cfop=t,r.ids.cfopId=t.id}},changeUnitOfMeasure:function(t,e){t&&(this.importedInvoice.products.productOfPurchaseCollection[e].unitOfMeasure=t)},linkProduct:function(t,e){var r=this;return Object(n["a"])(regeneratorRuntime.mark((function a(){var o,n;return regeneratorRuntime.wrap((function(a){while(1)switch(a.prev=a.next){case 0:if(o=t,o){a.next=3;break}return a.abrupt("return",r.productsInStock.splice(e,1,null));case 3:return a.next=5,r.checkIfProductSelectedIsParametrized(o,e);case 5:return n=a.sent,o.productIsParametrized=n,r.productsInStock.splice(e,1,o),a.abrupt("return",r.selectProductsWithSameCodeOrBarcode(e));case 9:case"end":return a.stop()}}),a)})))()},selectProductsWithSameCodeOrBarcode:function(t){var e=this,r=this.importedInvoice.products.productOfPurchaseCollection,a=r[t].barCode,o="".concat(r[t].importationCode,"|").concat(r[t].description);r.forEach((function(r,n){if(e.productsInStock[n]!==e.productsInStock[t]){var i="".concat(r.importationCode,"|").concat(r.description);(i===o||X["a"].checkStringIsOnlyNumbers(r.barCode)&&r.barCode===a)&&(e.linkProduct(e.productsInStock[t],n),e.$alert.isOpen||e.$alert.warning("Outros produtos possuem o mesmo código/código de barras e foram vinculados automaticamente."))}}))},searchProduct:function(t){var e=this;return Object(n["a"])(regeneratorRuntime.mark((function r(){return regeneratorRuntime.wrap((function(r){while(1)switch(r.prev=r.next){case 0:if(!t){r.next=3;break}return r.next=3,e.setProductCollection({search:t,orderType:L["a"].PURCHASE});case 3:case"end":return r.stop()}}),r)})))()},checkIfProductSelectedIsParametrized:function(t,e){var r=this;return Object(n["a"])(regeneratorRuntime.mark((function a(){var o,n,i,c;return regeneratorRuntime.wrap((function(a){while(1)switch(a.prev=a.next){case 0:return o=r.importedInvoice.supplier.id,n=t.id,i=r.importedInvoice.products.productOfPurchaseCollection[e].importationCode,a.next=5,r.checkIfProductIsParametrized({supplierId:o,productId:n,supplierCode:i});case 5:return c=a.sent,a.abrupt("return",c);case 7:case"end":return a.stop()}}),a)})))()},getProductsInStockData:function(){var t=this;return this.productsInStock.map((function(e,r){var a=t.importedInvoice.products.productOfPurchaseCollection[r].importationCode,o=t.importedInvoice.products.productOfPurchaseCollection[r].unitOfMeasure.id;return{productId:(null===e||void 0===e?void 0:e.productId)||(null===e||void 0===e?void 0:e.id),unitOfMeasureId:o,supplierCode:a}}))},registerProductsInStock:function(){var t=arguments,e=this;return Object(n["a"])(regeneratorRuntime.mark((function r(){var a,o,n,c;return regeneratorRuntime.wrap((function(r){while(1)switch(r.prev=r.next){case 0:return a=t.length>0&&void 0!==t[0]?t[0]:-1,o=e.importedInvoice.products.productOfPurchaseCollection.map((function(t,r){var a,o,n,c,s=Object(i["a"])({},t);null!==s&&void 0!==s&&s.productId&&null!=s.productId||(s.productId=(null===(a=e.productsInStock[r])||void 0===a?void 0:a.productId)||(null===(o=e.productsInStock[r])||void 0===o?void 0:o.id));s.productId&&(s.description=s.description||(null===(n=e.productsInStock[r])||void 0===n?void 0:n.description)||(null===(c=e.productsInStock[r])||void 0===c?void 0:c.stockDescription));return s.productId||(s.stockDescription=s.description),s})),n=a>=0?[o[a]]:o,c=Object(i["a"])(Object(i["a"])({},e.importedInvoice),{},{products:{productOfPurchaseCollection:n}}),r.abrupt("return",e.registerProducts({data:c}));case 5:case"end":return r.stop()}}),r)})))()},parametrizeAll:function(){var t=this,e=this.importedInvoice.products.productOfPurchaseCollection,r=this.importedInvoice.supplier.id,a=this.importedInvoice.taxInformation.nfe.nfeNumber,o=e.filter((function(t){return!(null!==t&&void 0!==t&&t.productId)})),c=o.length?" o cadastro no estoque e":"",s="Deseja efetuar".concat(c," a parametrização de todos os itens vinculados?");this.confirm({title:"Confirmação",message:s,onOk:function(){var o=Object(n["a"])(regeneratorRuntime.mark((function o(){var n,c;return regeneratorRuntime.wrap((function(o){while(1)switch(o.prev=o.next){case 0:return t.setLoading(!0),o.next=3,t.parametrizeAllProducts({supplierId:r,nfeNumber:a,productOfTradeCollection:e});case 3:if(c=o.sent,null===(n=c.messages)||void 0===n||!n.length){o.next=8;break}return t.$alert.error("".concat(c.messages.map((function(t){return"<li>".concat(t,"</li>")})).join(""))),t.setLoading(!1),o.abrupt("return",!1);case 8:return o.next=10,t.updateImportedInvoiceData({products:c.products});case 10:return t.setProductsInStock(),t.setLoading(!1),t.productsInStock=t.productsInStock.map((function(t){if(!t)return null;var e=Object(i["a"])({},t);return e.productIsParametrized=!0,e})),o.abrupt("return",!0);case 14:case"end":return o.stop()}}),o)})));function c(){return o.apply(this,arguments)}return c}()})},unparametrizeAll:function(){var t=this,e=this.importedInvoice.products.productOfPurchaseCollection.map((function(t){return t.importationCode})),r=this.importedInvoice.supplier.id;this.confirm({title:"Confirmação",message:"Deseja desparametrizar todos os itens desse XML?",onOk:function(){t.unparametrizeAllProducts({supplierId:r,allSupplierProductCodes:e}),t.productsInStock=t.productsInStock.map((function(t){if(!t)return null;var e=Object(i["a"])({},t);return e.productIsParametrized=!1,e}))}})},checkForChangeParametrization:function(t){var e=this;return Object(n["a"])(regeneratorRuntime.mark((function r(){var a,o;return regeneratorRuntime.wrap((function(r){while(1)switch(r.prev=r.next){case 0:if(!e.productsInStock[t]){r.next=2;break}return r.abrupt("return",e.changeParametrization(t));case 2:return o=null===(a=e.importedInvoice.products.productOfPurchaseCollection[t])||void 0===a?void 0:a.description,r.abrupt("return",e.confirm({title:"Confirmação",message:'O Item "'.concat(o,'" ainda não foi criado no estoque, deseja criar o produto e depois parametrizá-lo?'),onOk:function(){var r=Object(n["a"])(regeneratorRuntime.mark((function r(){var a,o,n,c;return regeneratorRuntime.wrap((function(r){while(1)switch(r.prev=r.next){case 0:return r.next=2,e.registerProductsInStock(t);case 2:if(o=r.sent,null===(a=o.messages)||void 0===a||!a.length){r.next=6;break}return e.$alert.error("".concat(o.messages.map((function(t){return"<li>".concat(t,"</li>")})).join(""))),r.abrupt("return",!1);case 6:return n=Object(P["a"])(o.products.productOfPurchaseCollection,1),c=n[0],e.importedInvoice.products.productOfPurchaseCollection.splice(t,1,c),e.productsInStock[t]=Object(i["a"])(Object(i["a"])({},c),{},{description:c.stockDescription||c.description}),r.abrupt("return",e.changeParametrization(t));case 10:case"end":return r.stop()}}),r)})));function a(){return r.apply(this,arguments)}return a}()}));case 4:case"end":return r.stop()}}),r)})))()},changeParametrization:function(t){var e=this;return Object(n["a"])(regeneratorRuntime.mark((function r(){var a,o,n,i,c,s,u;return regeneratorRuntime.wrap((function(r){while(1)switch(r.prev=r.next){case 0:return a=e.importedInvoice.supplier.id,o=e.productsInStock[t].id||e.productsInStock[t].productId,n=e.importedInvoice.products.productOfPurchaseCollection[t].importationCode,i=e.importedInvoice.products.productOfPurchaseCollection[t].unitOfMeasure.id,c=!0===e.productsInStock[t].productIsParametrized,r.next=7,e.checkIfCodeHasParametrization({supplierId:a,supplierCode:n});case 7:s=r.sent,u=s.hasParametrization?"Esse item está parametrizado para o produto: ".concat(s.productCode," - ").concat(s.productDescription,", deseja reparametrizar?"):"O código do produto selecionado será vinculado (fornecedor com produto) para facilitar importações futuras. Confirma operação?",c&&(u="Deseja mesmo desparametrizar esse item?"),e.confirm({title:"Confirmação",message:u,onOk:function(){e.changeProductParametrization({supplierId:a,productId:o,supplierCode:n,unitOfMeasureId:i,isParametrized:c}),e.productsInStock[t].productIsParametrized=!c,e.setProductCollection({search:"",orderType:L["a"].PURCHASE})}});case 11:case"end":return r.stop()}}),r)})))()},removeProduct:function(t){this.productsInStock.splice(t,1),this.importedInvoice.products.productOfPurchaseCollection.splice(t,1)}})},H=U,E=(r("29df"),r("b8fd"),Object(S["a"])(H,I,O,!1,null,"0fb0c60c",null)),q=E.exports,W=function(){var t=this,e=t.$createElement,r=t._self._c||e;return r("Modal",{staticClass:"importationModal",attrs:{value:t.modalManifestedXmlsIsOpen,onClose:t.cancel,size:"large"}},[r("b-container",[r("p",[t._v(' Listando os últimos 50 manifestos de "Confirmação da operação", exibindo apenas os que ainda não foram importados para as Compras ')]),r("p",[t._v(" Para importar um manifesto, clique sobre o manifesto desejado e depois em Importar ")]),r("div",{staticClass:"wrapper"},[r("table",{staticClass:"manifestos"},[r("thead",[r("tr",[r("th",[t._v("Número")]),r("th",[t._v("Chave")]),r("th",[t._v("Fornecedor")]),r("th",[t._v("Valor")])])]),r("tbody",[t._l(t.manifestos,(function(e,a){return r("tr",{key:a,class:{selected:t.selected.id===e.id},on:{click:function(r){return t.onSelectManifesto(e,r)}}},[r("td",[t._v(t._s(e.numero))]),r("td",[t._v(t._s(e.chave))]),r("td",[t._v(t._s(e.fornecedor))]),r("td",[t._v(t._s(e.valorTotal))])])})),t.loading||t.manifestos.length?t._e():r("tr",[r("td",{attrs:{colspan:"4"}},[t._v(" Nenhum Manifesto encontrado ")])])],2)])])]),r("b-row",{staticClass:"margin-button-save",attrs:{align:"center"}},[r("b-col",[r("Button",{attrs:{type:"cancel"},on:{click:t.cancel}},[r("Close",{staticClass:"mb-1",attrs:{disabled:t.loading,title:"Cancelar"}}),t._v(" Cancelar ")],1),r("Button",{attrs:{type:"success",disabled:!t.selected.id||t.loading},on:{click:t.onConfirm}},[t._v("Importar")])],1)],1)],1)},Y=[],Z={name:"ModalManifestedXmls",mixins:[d["a"]],components:{Modal:u["u"],Button:u["c"],Close:s["a"]},props:{confirm:{type:Function}},data:function(){return{loading:!0,manifestos:[],selected:{}}},mounted:function(){var t=this;return Object(n["a"])(regeneratorRuntime.mark((function e(){var r;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.prev=0,t.loading=!0,e.next=4,t.getPendingManifestos();case 4:r=e.sent,t.manifestos=r.map((function(t){var e=new Intl.NumberFormat("pt-BR",{style:"decimal",minimumFractionDigits:2}).format(t.valorTotal);return Object(i["a"])(Object(i["a"])({},t),{},{valorTotal:e})}));case 6:return e.prev=6,t.loading=!1,e.finish(6);case 9:case"end":return e.stop()}}),e,null,[[0,,6,9]])})))()},computed:Object(i["a"])({},Object(c["d"])("componentsPurchase",["modalManifestedXmlsIsOpen"])),methods:Object(i["a"])(Object(i["a"])(Object(i["a"])({},Object(c["b"])("componentsPurchase",["toggleModalManifestedXmls"])),Object(c["b"])("purchase",["getPendingManifestos"])),{},{onConfirm:function(){var t=this;return Object(n["a"])(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(!t.loading){e.next=2;break}return e.abrupt("return");case 2:return e.prev=2,t.loading=!0,e.next=6,t.confirm(t.selected);case 6:return e.prev=6,t.loading=!1,e.finish(6);case 9:case"end":return e.stop()}}),e,null,[[2,,6,9]])})))()},onSelectManifesto:function(t){this.loading||(this.selected=Object(i["a"])({},t))},cancel:function(){var t=this;return Object(n["a"])(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,t.toggleModalManifestedXmls();case 2:case"end":return e.stop()}}),e)})))()}})},J=Z,K=(r("273e"),Object(S["a"])(J,W,Y,!1,null,"55717bc3",null)),Q=K.exports,G=function(){var t=this,e=t.$createElement,r=t._self._c||e;return r("Modal",{attrs:{value:t.modalPriceUpdateIsOpen,onClose:t.cancel,title:"Atualização de Preço de Venda",size:"large"}},[t.productCollection.length?r("b-row",{staticClass:"form-group table-list-products"},[r("table",{staticClass:"table table-price-update"},[r("thead",{staticClass:"fixed"},[r("tr",[r("th",{staticClass:"col-4"},[t._v("Descrição")]),r("th",{staticClass:"text-right col-2"},[t._v("Preço de Custo")]),r("th",{staticClass:"text-right col-2"},[t._v(" Lucro Bruto "),t.client.isDefaultProfitPercentEnabled?[t._v(" (Padrão "+t._s(t.roundAndFormat(t.defaultProfitPercent,2))+"%) ")]:t._e()],2),r("th",{staticClass:"text-right col-2"},[t._v("Preço Atual")]),r("th",{staticClass:"text-right col-2"},[t._v("Novo Preço")])])]),r("tbody",t._l(t.productCollection,(function(e,a){return r("tr",{key:a},[r("td",{staticClass:"col-4"},[t._v(t._s(e.description))]),r("td",{staticClass:"text-right col-2"},[t._v(" "+t._s(t.roundAndFormat(t.valueConverted(e.cost||0,e.unitOfMeasure),t.decimalConfiguration.price))+" ")]),r("td",{staticClass:"text-right col-2"},[parseFloat(e.product.profitPercent)>=0?[t._v(" ("+t._s(t.roundAndFormat(e.product.profitPercent,2))+"%) ")]:t._e(),t._v(" "+t._s(t.roundAndFormat(t.getProductProfit(e),t.decimalConfiguration.price))+" ")],2),r("td",{staticClass:"text-right col-2"},[t._v(" "+t._s(t.roundAndFormat(e.product.price||0,t.decimalConfiguration.price))+" ")]),r("td",{staticClass:"text-right col-2"},[r("InputMoney",{ref:"unitPrice",refInFor:!0,attrs:{id:"unitPrice",inputClass:"form-control input",prefix:!1,labelBold:"",max:11},model:{value:e.product.newPrice,callback:function(r){t.$set(e.product,"newPrice",r)},expression:"item.product.newPrice"}})],1)])})),0)])]):t._e(),r("Confirm",{attrs:{onOk:t.modalConfirm.onOk,title:t.modalConfirm.title,message:t.modalConfirm.message,type:t.modalConfirm.type},model:{value:t.modalConfirm.open,callback:function(e){t.$set(t.modalConfirm,"open",e)},expression:"modalConfirm.open"}}),r("b-row",{staticClass:"margin-button-save",attrs:{align:"center"}},[r("b-col",[r("Button",{attrs:{type:"cancel"},on:{click:t.cancel}},[r("Close",{staticClass:"mb-1",attrs:{title:"Cancelar"}}),t._v(" Cancelar ")],1),r("Button",{attrs:{type:"success"},on:{click:t.updateAllToProfit}},[t._v("Atualizar pelo Lucro Bruto")]),r("Button",{attrs:{type:"success"},on:{click:t.updateAllToDefaultPrice}},[t._v("Recalcular")]),r("Button",{attrs:{type:"success"},on:{click:t.save}},[t._v("Salvar")])],1)],1)],1)},tt=[],et=r("15aa"),rt={name:"ModalPriceUpdate",mixins:[d["a"],et["a"]],components:{Modal:u["u"],InputMoney:u["o"],Button:u["c"],Close:s["a"],Confirm:u["h"]},props:{confirm:{type:Function}},data:function(){return{productCollection:[],modalConfirm:{title:"",message:"",type:1,onOk:function(){return null},open:!1}}},created:function(){var t=this;return Object(n["a"])(regeneratorRuntime.mark((function e(){var r,a,o,n,c,s,u;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,t.calculateProductsCost(t.purchase);case 2:if(r=e.sent,!r){e.next=8;break}return a=r.products.productOfPurchaseCollection.map((function(t){return t.price})),o={productOfPurchaseCollection:t.items.map((function(t,e){return Object(i["a"])(Object(i["a"])({},t),{},{cost:a[e]})}))},e.next=8,t.updatePurchaseData(Object(i["a"])(Object(i["a"])({},t.purchase),{},{products:o}));case 8:return n=t.items.map((function(t){return t.productId})),e.next=11,t.$http.post("/inventory.get-product",{ids:n,active:!0});case 11:c=e.sent,s=c.data,u=Array.isArray(s)?s:s.data,t.productCollection=t.items.map((function(t){var e;return Object(i["a"])(Object(i["a"])({},t),{},{product:null!==(e=u.find((function(e){return e.id===t.productId})))&&void 0!==e?e:{}})})),t.updateAllToDefaultPrice();case 16:case"end":return e.stop()}}),e)})))()},computed:Object(i["a"])(Object(i["a"])(Object(i["a"])(Object(i["a"])(Object(i["a"])({},Object(c["d"])("componentsPurchase",["modalPriceUpdateIsOpen"])),Object(c["d"])("client",["client"])),Object(c["d"])("purchase",["purchase","products"])),Object(c["c"])("purchase",["decimalConfiguration"])),{},{defaultProfitPercent:function(){return this.client.isDefaultProfitPercentEnabled&&this.client.defaultProfitPercent||0},items:function(){var t=this.purchase.products.productOfPurchaseCollection;return t}}),methods:Object(i["a"])(Object(i["a"])(Object(i["a"])({},Object(c["b"])("componentsPurchase",["toggleModalPriceUpdate"])),Object(c["b"])("purchase",["calculateProductsCost","updatePurchaseData"])),{},{cancel:function(){var t=this;this.modalConfirm={title:"Cancelar Atualização de Preço",message:"Tem certeza que deseja cancelar?",type:1,onOk:function(){t.toggleModalPriceUpdate()},open:!0}},save:function(){var t=this;return Object(n["a"])(regeneratorRuntime.mark((function e(){var r,a;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:r=t.purchase.products.productOfPurchaseCollection,a=r.map((function(e,r){var a;return Object(i["a"])(Object(i["a"])({},e),{},{newPrice:t.toNumber(null===(a=t.productCollection[r])||void 0===a?void 0:a.product.newPrice)})})),t.confirm(a);case 3:case"end":return e.stop()}}),e)})))()},getProductProfit:function(t){var e=t.product,r=e.price,a=this.valueConverted(t.cost||0,t.unitOfMeasure),o=e.profitPercent;if(0===parseFloat(e.profitPercent))return r;var n=o||this.defaultProfitPercent,i=n>0?a*n/100:0;return this.round(i+a,this.decimalConfiguration.price)},updateAllToProfit:function(){var t=this;this.modalConfirm={title:"Atualização de Preço",message:"Tem certeza que deseja Atualizar todos os produtos pelo Lucro Bruto?",type:1,onOk:function(){t.productCollection=t.productCollection.map((function(e){return Object(i["a"])(Object(i["a"])({},e),{},{product:Object(i["a"])(Object(i["a"])({},e.product),{},{newPrice:t.getProductProfit(e)})})}))},open:!0}},updateAllToDefaultPrice:function(){this.productCollection=this.productCollection.map((function(t){return Object(i["a"])(Object(i["a"])({},t),{},{product:Object(i["a"])(Object(i["a"])({},t.product),{},{newPrice:t.product.id?t.product.price:0})})}))},valueConverted:function(t,e){return e.converterOperator===V["a"]?t*e.converter:e.converterOperator===V["b"]?t/e.converter:t}})},at=rt,ot=(r("d663"),Object(S["a"])(at,G,tt,!1,null,null,null)),nt=ot.exports,it=r("b8f8"),ct={name:"purchaseRegister",mixins:[d["a"]],components:{Layout:u["s"],Button:l["a"],TaxInformation:p["a"],LinkedDocuments:m["a"],Supplier:f["a"],Products:v["a"],TaxCalc:h["a"],Payment:b["a"],Transport:C["a"],ModalFiscalProduct:g["a"],ImportXmlFile:u["l"],ModalImportXml:q,ModalManifestedXmls:Q,ModalPriceUpdate:nt,Close:s["a"]},data:function(){return{collapsesToValidate:["taxInformation","supplier","products","payments"]}},computed:Object(i["a"])(Object(i["a"])(Object(i["a"])(Object(i["a"])({},Object(c["d"])("purchase",["purchase","importedInvoice","importedInvoiceFormData"])),Object(c["d"])("componentsPurchase",["modalImportXmlIsOpen","modalManifestedXmlsIsOpen","modalPriceUpdateIsOpen"])),Object(c["d"])("client",["client"])),{},{showLinkedDocuments:function(){var t,e,r,a,o=null===(t=this.purchase)||void 0===t||null===(e=t.taxInformation)||void 0===e||null===(r=e.natureza)||void 0===r||null===(a=r.cfop)||void 0===a?void 0:a.codigo,n=null===o||void 0===o?void 0:o.substr(1,3);if(!n)return!1;var i=["351","352","353"];return this.purchase.taxInformation.nfeModel===it["a"].CTE&&i.includes(n)}}),props:{confirm:{type:Function},manifestoId:{required:!1,type:Number}},created:function(){this.setDecimalConfiguration()},mounted:function(){var t=this;return Object(n["a"])(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(!t.emptyIssuerBasicData()){e.next=3;break}return t.$router.push({path:"/inventory/purchase"}),e.abrupt("return");case 3:return e.next=5,Promise.all([t.setOrigemCollection(),t.setCSTCollection(),t.setCSTIPICollection(),t.setCSTPISCollection(),t.setCSTCOFINSCollection(),t.setCENQCollection(),t.setCSOSNCollection(),t.setUnitOfMeasureCollection()]);case 5:if(!t.manifestoId){e.next=13;break}return e.prev=6,t.setLoading(!0),e.next=10,t.importManifestToPurchase({id:t.manifestoId});case 10:return e.prev=10,t.setLoading(!1),e.finish(10);case 13:case"end":return e.stop()}}),e,null,[[6,,10,13]])})))()},methods:Object(i["a"])(Object(i["a"])(Object(i["a"])(Object(i["a"])(Object(i["a"])(Object(i["a"])(Object(i["a"])(Object(i["a"])(Object(i["a"])(Object(i["a"])({},Object(c["b"])("cenq",["setCENQCollection"])),Object(c["b"])("csosn",["setCSOSNCollection"])),Object(c["b"])("client",["setClient"])),Object(c["b"])("origem",["setOrigemCollection"])),Object(c["b"])("application",["setLoading"])),Object(c["b"])("unitOfMeasure",["setUnitOfMeasureCollection"])),Object(c["b"])("purchase",["importXml","setPurchase","savePurchase","updatePurchaseData","hasInvalidCollapse","setDecimalConfiguration","importManifestoIntoPurchase"])),Object(c["b"])("cst",["setCSTCollection","setCSTIPICollection","setCSTPISCollection","setCSTCOFINSCollection"])),Object(c["b"])("componentsPurchase",["toggleModalImportXml","toggleModalManifestedXmls","toggleModalPriceUpdate"])),{},{emptyIssuerBasicData:function(){return!this.client.addressCollection.length||!this.client.identification},setDefaultFields:function(){this.$refs.payments.setDefaultFields()},isValidPurchase:function(){var t=this;return Object(n["a"])(regeneratorRuntime.mark((function e(){var r;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(t.$refs.taxInformation.$v.$touch(),t.$refs.supplier.$v.$touch(),t.$refs.products.$v.$touch(),t.$refs.payments.$v.$touch(),!t.haveProductWithNegativePrice(t.$refs.products)){e.next=7;break}return t.$alert.warning("Não é possivel salvar, existem produto com valor negativo"),e.abrupt("return",!1);case 7:return r={collapsesToValidate:t.collapsesToValidate,refs:t.$refs,root:t.$root},e.next=10,t.hasInvalidCollapse(r);case 10:if(!e.sent){e.next=12;break}return e.abrupt("return",!1);case 12:return e.abrupt("return",!0);case 13:case"end":return e.stop()}}),e)})))()},haveProductWithNegativePrice:function(t){return!!t.products.productOfPurchaseCollection.find((function(t){return Number(t.totalPrice)+Number(t.vFrete)+Number(t.vOutro)-Number(t.vDesc)<0}))},handleSavePurchase:function(){var t=this;return Object(n["a"])(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return t.setDefaultFields(),e.next=3,t.isValidPurchase();case 3:if(e.sent){e.next=5;break}return e.abrupt("return",!1);case 5:return e.next=7,t.setPurchase();case 7:if(!t.entryDateIsLowerThanIssueDate()){e.next=9;break}return e.abrupt("return",t.$alert.warning("Data de entrada não pode ser menor que data de emissão."));case 9:if(t.setEmptyProductOfPurchaseCfops(),t.validatePayment()){e.next=12;break}return e.abrupt("return",t.confirm({title:"Confirmação",message:"As formas de pagamento não correspondem com o total da nota, deseja continuar?",onOk:function(){return t.registerPurchase()}}));case 12:return e.abrupt("return",t.registerPurchase());case 13:case"end":return e.stop()}}),e)})))()},setEmptyProductOfPurchaseCfops:function(){var t=this.purchase,e=t.taxInformation,r=t.products,a=e.natureza.cfop;r.productOfPurchaseCollection=r.productOfPurchaseCollection.map((function(t){var e=t.fiscal.ids.cfopId;return e||(t.fiscal.values.cfop=a,t.fiscal.ids.cfopId=a.id),t}))},setPurchaseCfopInItems:function(){var t=this.purchase,e=t.taxInformation,r=t.products,a=e.natureza.cfop;r.productOfPurchaseCollection=r.productOfPurchaseCollection.map((function(t){return t.fiscal.values.cfop=a,t.fiscal.ids.cfopId=a.id,t}))},onConfirmPriceUpdateModal:function(t){var e=this;return Object(n["a"])(regeneratorRuntime.mark((function r(){return regeneratorRuntime.wrap((function(r){while(1)switch(r.prev=r.next){case 0:return r.next=2,e.updatePurchaseData(Object(i["a"])(Object(i["a"])({},e.purchase),{},{products:{productOfPurchaseCollection:t}}));case 2:e.toggleModalPriceUpdate();case 3:case"end":return r.stop()}}),r)})))()},registerPurchase:function(){var t=this;return Object(n["a"])(regeneratorRuntime.mark((function e(){var r;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return t.setLoading(!0),e.prev=1,e.next=4,t.savePurchase(t.purchase);case 4:return e.prev=4,t.setLoading(!1),r=t.purchase.taxInformation.natureza.id,localStorage.setItem("lastPurchaseNaturezaId",r),e.finish(4);case 9:return t.$alert.success("Compra salva com sucesso!"),e.abrupt("return",t.$router.push({path:"/inventory/purchase"}));case 11:case"end":return e.stop()}}),e,null,[[1,,4,9]])})))()},validatePayment:function(){var t=this,e="Nenhum",r=this.purchase.payments.paymentModeCollection[0].name,a=this.purchase.taxCalc.vNF,o=this.purchase.payments.paymentModeCollection.reduce((function(e,r){return e+t.round(r.value,2)}),0);return r===e||o===a},entryDateIsLowerThanIssueDate:function(){var t=this.$moment(this.purchase.taxInformation.entryDate).format("YYYY-MM-DD"),e=this.$moment(this.purchase.taxInformation.issueDate).format("YYYY-MM-DD");return t<e},handleCancelPurchase:function(){return this.$router.push({name:"Purchase"})},importManifestToPurchase:function(t){var e=this;return Object(n["a"])(regeneratorRuntime.mark((function r(){return regeneratorRuntime.wrap((function(r){while(1)switch(r.prev=r.next){case 0:if(t&&t.id){r.next=2;break}return r.abrupt("return");case 2:return r.next=4,e.importManifestoIntoPurchase(t);case 4:case"end":return r.stop()}}),r)})))()},handleXmlFile:function(t){var e=this;return Object(n["a"])(regeneratorRuntime.mark((function r(){var a;return regeneratorRuntime.wrap((function(r){while(1)switch(r.prev=r.next){case 0:return e.setLoading(!0),a=new FormData,a.append("file",t),r.prev=3,r.next=6,e.importXml(a);case 6:return r.prev=6,e.setLoading(!1),r.finish(6);case 9:case"end":return r.stop()}}),r,null,[[3,,6,9]])})))()},handleManifestedXmlModal:function(){var t=this;return Object(n["a"])(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:t.toggleModalManifestedXmls();case 1:case"end":return e.stop()}}),e)})))()}}),watch:{importedInvoice:function(t){var e=this;if(!t&&this.modalImportXmlIsOpen)return this.toggleModalImportXml();if(t){var r=this.importedInvoice.warnings;r&&r.forEach((function(t){e.$alert.warning(t)})),this.modalManifestedXmlsIsOpen&&this.toggleModalManifestedXmls(),this.modalImportXmlIsOpen||this.toggleModalImportXml()}return null},modalImportXmlIsOpen:function(t){t||this.importedInvoiceFormData&&this.client.isRequestPriceUpdateEnabled&&this.toggleModalPriceUpdate()}}},st=ct,ut=Object(S["a"])(st,a,o,!1,null,null,null);e["default"]=ut.exports},b018:function(t,e,r){"use strict";r("ac1f"),r("5319");function a(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2,r=Math.pow(10,e),a=t+.005/r,o=Math.round(a*r);return o/r}function o(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",e="".concat(t).replace(",",".");return parseFloat(e)||0}function n(t){return/^[0-9]+$/.test(t)}e["a"]={round:a,stringToFloat:o,checkStringIsOnlyNumbers:n}},b8fd:function(t,e,r){"use strict";r("45f4")},d663:function(t,e,r){"use strict";r("334f")}}]);
//# sourceMappingURL=chunk-2e35b2c6.ee9d9a15.js.map